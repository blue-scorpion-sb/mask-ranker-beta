<!DOCTYPE html> 

<html lang="zh-HK"> 

<head> 

    <meta charset="UTF-8"> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 

    <title>é¢è†œåˆ†æå¤§å¸« âœ¨</title> 

    <script src="https://cdn.tailwindcss.com"></script> 

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 

    <style> 

        body { font-size: 14px; background: #fff5f7; font-family: system-ui, -apple-system, sans-serif; overflow-x: hidden; } 

        .quadrant-bg { background-size: 20px 20px; background-image: radial-gradient(circle, #fbcfe8 1px, transparent 1px); } 

 

        .outer-label { font-size: 0.8rem; font-weight: 800; position: absolute; z-index: 40; pointer-events: none; padding: 4px 8px; border-radius: 6px; background: rgba(255,255,255,0.85); backdrop-filter: blur(4px); } 

        .label-tl { top: 0.8rem; left: 0.8rem; color: #ef4444; border-left: 4px solid #ef4444; } 

        .label-tr { top: 0.8rem; right: 0.8rem; color: #8b5cf6; border-right: 4px solid #8b5cf6; } 

        .label-bl { bottom: 0.8rem; left: 0.8rem; color: #64748b; border-left: 4px solid #64748b; } 

        .label-br { bottom: 0.8rem; right: 0.8rem; color: #db2777; border-right: 4px solid #db2777; } 

 

        #infoDrawer { 

            position: fixed; background: #1e293b; color: white; z-index: 5000; 

            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 40px rgba(0,0,0,0.3); 

            overflow-y: auto; 

        } 

        @media (max-width: 767px) { 

            #infoDrawer { bottom: 0; left: 0; right: 0; height: 80vh; border-top-left-radius: 2rem; border-top-right-radius: 2rem; transform: translateY(100%); padding: 1.5rem; } 

            #infoDrawer.open { transform: translateY(0); } 

        } 

        @media (min-width: 768px) { 

            #infoDrawer { top: 0; right: 0; bottom: 0; width: 380px; transform: translateX(100%); padding: 2.5rem 2rem; } 

            #infoDrawer.open { transform: translateX(0); } 

        } 

 

        .mask-node { cursor: pointer; z-index: 100; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); } 

        /* æ»‘é¼ ç¶“éç«‹åˆ»ç½®é ‚ï¼Œè§£æ±ºé‡ç–Šé¸ä¸åˆ°çš„å•é¡Œ */ 

        .mask-node:hover { z-index: 2000 !important; transform: scale(1.15); } 

        .active-node { z-index: 2100 !important; } 

        .active-node .node-inner { border: 3px solid #ec4899 !important; box-shadow: 0 0 15px rgba(236,72,153,0.5); transform: scale(1.1); } 

         

        .axis-line { position: absolute; background: rgba(244, 114, 182, 0.3); pointer-events: none; } 

    </style> 

</head> 

<body onclick="closeAllDrawers()" class="p-4 md:p-6"> 

 

    <div class="max-w-[1300px] mx-auto"> 

        <header class="mb-4 flex items-baseline gap-2"> 

            <h1 class="text-2xl font-black text-pink-600 italic">é¢è†œåˆ†æå¤§å¸«</h1> 

            <span class="text-[10px] text-pink-400 font-bold border border-pink-200 px-1.5 rounded uppercase">Beta</span> 

        </header> 

 

        <div class="flex flex-col lg:flex-row gap-4 items-start"> 

            <div class="w-full lg:w-[300px] shrink-0 order-2 lg:order-1" onclick="event.stopPropagation()"> 

                <div class="bg-white p-5 rounded-[1.8rem] shadow-lg border border-pink-50 sticky top-6"> 

                    <h2 id="formTitle" class="text-lg font-black mb-4 text-slate-800">ğŸš€ è©•æ¸¬é¢è†œ</h2> 

                    <div class="space-y-3"> 

                        <input type="text" id="mName" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none border-2 border-transparent focus:border-pink-200" placeholder="ğŸ·ï¸ é¢è†œåç¨±"> 

                        <div class="grid grid-cols-2 gap-2"> 

                            <input type="number" id="mPrice" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="ğŸ’° åƒ¹éŒ¢"> 

                            <input type="number" id="mRating" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="â­ è©•åˆ†"> 

                        </div> 

                        <input type="text" id="mSource" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="ğŸ“ è³¼å…¥åœ°é»"> 

                        <textarea id="mComment" maxlength="20" rows="1" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none resize-none" placeholder="ğŸ’¬ çŸ­è©• (20å­—)"></textarea> 

                         

                        <label for="mImg" class="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed border-pink-100 rounded-xl cursor-pointer bg-pink-50/30 overflow-hidden relative"> 

                            <img id="imgPreview" class="absolute inset-0 w-full h-full object-cover hidden"> 

                            <div id="uploadPrompt" class="text-center text-pink-300"> 

                                <span class="text-xl">ğŸ“¸</span> 

                                <p class="text-[9px] font-bold uppercase mt-1">ä¸Šå‚³åœ–ç‰‡</p> 

                            </div> 

                            <input type="file" id="mImg" accept="image/*" class="hidden" onchange="handleImageSelect(this)"> 

                        </label> 

                         

                        <button onclick="saveData()" id="saveBtn" class="w-full bg-pink-600 text-white font-black py-3 rounded-xl shadow-md active:scale-95 transition-all text-sm">ç™¼å¸ƒåˆ†æ</button> 

                    </div> 

                </div> 

            </div> 

 

            <div class="flex-1 w-full order-1 lg:order-2"> 

                <div id="pinch-viewport" class="aspect-square max-h-[78vh] shadow-xl overflow-hidden rounded-[1.8rem] bg-white border-4 border-white relative"> 

                    <div id="canvas-area" class="quadrant-bg w-full h-full relative"> 

                        <div class="outer-label label-tl">ğŸ’¸ æµªè²»é‡‘éŒ¢</div> 

                        <div class="outer-label label-tr">ğŸ’ è²´å©¦ä¹‹é¸</div> 

                        <div class="outer-label label-bl">ğŸ’¤ å¹³åƒ¹ç²—ç”¨</div> 

                        <div class="outer-label label-br">âœ¨ å¿…é ˆå›è³¼</div> 

                        <div id="yLine" class="axis-line h-[calc(100%-40px)] w-[2px] top-[20px]"></div> 

                        <div id="xLine" class="axis-line w-[calc(100%-40px)] h-[2px] left-[20px]"></div> 

                        <div id="chartArea" class="absolute inset-0 p-8 md:p-12"></div> 

                    </div> 

                </div> 

            </div> 

        </div> 

    </div> 

 

    <div id="infoDrawer" onclick="event.stopPropagation()"> 

        <button onclick="closeAllDrawers()" class="absolute top-5 right-5 text-white/50 hover:text-white text-xl">âœ•</button> 

        <div id="drawerContent"></div> 

    </div> 

 

    <script> 

        const SB_URL = 'https://ayulzvrljioqcfoqrsev.supabase.co'; 

        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dWx6dnJsamlvcWNmb3Fyc2V2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNzk3MzUsImV4cCI6MjA4NDk1NTczNX0.3iCIGRfR42cg12qoE5IUHb0EFn1yq9dDqAW-jcFmQDo'; 

        const client = supabase.createClient(SB_URL, SB_KEY); 

 

        let myName = localStorage.getItem('mask_username'), cachedData = []; 

 

        async function initApp() { 

            if (!myName) { myName = prompt("åå­—ï¼š") || "åˆ†æå¸«"; localStorage.setItem('mask_username', myName); } 

            await loadData(); 

            setInterval(loadData, 20000); 

        } 

 

        async function loadData() { 

            const { data, error } = await client.from('masks').select('*').order('created_at', { ascending: false }); 

            if (!error) { 

                cachedData = data; 

                const maxPrice = data.length > 0 ? Math.max(...data.map(m => m.price), 1) : 50; 

                window.limitP = Math.ceil(maxPrice); 

                window.splitP = window.limitP / 2; 

                renderCurrentData(); 

            } 

        } 

 

        function renderCurrentData() { 

            const area = document.getElementById('chartArea'); area.innerHTML = ''; 

            const lp = window.limitP, lr = 10; 

 

            cachedData.forEach((m, idx) => { 

                const xBase = 10 + (((m.rating - 1) / (lr - 1)) * 80); 

                const yBase = 10 + ((1 - (m.price / lp)) * 80); 

                 

                // ã€æ ¸å¿ƒæ”¹å‹•ã€‘åŠ å¤§éš¨æ©Ÿåç§»é‡ (Jittering) åˆ° 5%ï¼Œç¢ºä¿é»è·Ÿé»ä¹‹é–“è‡ªç„¶éŒ¯é–‹ 

                const jitterX = (Math.random() - 0.5) * 5; 

                const jitterY = (Math.random() - 0.5) * 5; 

 

                const node = document.createElement('div'); 

                node.className = `mask-node absolute w-10 h-10 md:w-11 md:h-11 -ml-5 -mt-5 md:-ml-5.5 md:-mt-5.5`; 

                node.style.left = `${xBase + jitterX}%`; 

                node.style.top = `${yBase + jitterY}%`; 

                node.style.zIndex = 100 + idx; 

                 

                node.onclick = (e) => { 

                    e.stopPropagation(); 

                    document.querySelectorAll('.mask-node').forEach(n => n.classList.remove('active-node')); 

                    node.classList.add('active-node'); 

                    showInfo(m); 

                }; 

 

                node.innerHTML = `<div class="node-inner w-full h-full rounded-xl border-2 shadow-sm overflow-hidden bg-white ${m.user_name === myName ? 'border-pink-500' : 'border-slate-100'}"> 

                    ${m.img_url ? `<img src="${m.img_url}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center font-bold text-slate-200 text-[10px]">${m.name[0]}</div>`} 

                </div>`; 

                area.appendChild(node); 

            }); 

            updateAxis(); 

        } 

 

        function updateAxis() { 

            const lp = window.limitP, lr = 10, sp = window.splitP, sr = 5; 

            const pad = 20; 

            const w = viewport.clientWidth - (pad * 2); 

            const h = viewport.clientHeight - (pad * 2); 

            document.getElementById('yLine').style.left = `calc(${pad}px + ${((sr - 1) / (lr - 1)) * w}px)`; 

            document.getElementById('xLine').style.top = `calc(${pad}px + ${(1 - (sp / lp)) * h}px)`; 

        } 

 

        function showInfo(m) { 

            const drawer = document.getElementById('infoDrawer'); 

            document.getElementById('drawerContent').innerHTML = ` 

                <div class="w-full aspect-square rounded-2xl overflow-hidden bg-slate-800 mb-6 shadow-lg"> 

                    ${m.img_url ? `<img src="${m.img_url}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center text-4xl opacity-10">ğŸ“¸</div>`} 

                </div> 

                <div class="flex justify-between items-start mb-1"> 

                    <h3 class="text-xl font-black text-pink-400 leading-tight">${m.name}</h3> 

                    <div class="flex gap-4 text-lg"> 

                        <button onclick="startEdit(${m.id}, '${m.name.replace(/'/g, "\\'")}', ${m.price}, ${m.rating}, '${m.source}', '${m.comment}')">âœï¸</button> 

                        <button onclick="deleteItem(${m.id})" class="text-red-400">ğŸ—‘ï¸</button> 

                    </div> 

                </div> 

                <p class="text-[10px] font-bold opacity-30 uppercase tracking-widest mb-6">By ${m.user_name}</p> 

                <div class="grid grid-cols-2 gap-3 mb-4 text-white"> 

                    <div class="bg-white/5 p-4 rounded-2xl"><p class="text-[9px] opacity-30 mb-1 uppercase tracking-tighter">åƒ¹éŒ¢</p><p class="text-2xl font-black italic">$${m.price}</p></div> 

                    <div class="bg-white/5 p-4 rounded-2xl"><p class="text-[9px] opacity-30 mb-1 uppercase tracking-tighter">è©•åˆ†</p><p class="text-2xl font-black italic">${m.rating}/10</p></div> 

                </div> 

                <div class="bg-white/5 p-4 rounded-2xl mb-4 text-sm"> 

                    <p class="text-[9px] opacity-30 mb-1 uppercase font-bold tracking-widest">è³¼å…¥åœ°é»</p> 

                    <p>ğŸ“ ${m.source || '-'}</p> 

                </div> 

                <div class="bg-pink-600/10 p-5 rounded-2xl border border-pink-500/10"> 

                    <p class="italic text-sm text-pink-50 leading-relaxed">"${m.comment || 'æš«ç„¡è©•åƒ¹ã€‚'}"</p> 

                </div> 

            `; 

            drawer.classList.add('open'); 

        } 

 

        const viewport = document.getElementById('pinch-viewport'); 

        function closeAllDrawers() {  

            document.getElementById('infoDrawer').classList.remove('open');  

            document.querySelectorAll('.mask-node').forEach(n => n.classList.remove('active-node')); 

        } 

        function handleImageSelect(input) { if (input.files && input.files[0]) { const r = new FileReader(); r.onload = e => { document.getElementById('imgPreview').src = e.target.result; document.getElementById('imgPreview').classList.remove('hidden'); document.getElementById('uploadPrompt').classList.add('hidden'); }; r.readAsDataURL(input.files[0]); } } 

        async function saveData() { 

            const name = document.getElementById('mName').value; 

            const price = parseFloat(document.getElementById('mPrice').value); 

            const rating = parseFloat(document.getElementById('mRating').value); 

            if (!name || isNaN(price)) return alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™"); 

            try { 

                let imgUrl = ""; 

                const imgFile = document.getElementById('mImg').files[0]; 

                if (imgFile) { 

                    const fileName = `${Date.now()}.jpg`; 

                    await client.storage.from('mask-images').upload(fileName, imgFile); 

                    imgUrl = client.storage.from('mask-images').getPublicUrl(fileName).data.publicUrl; 

                } 

                const p = { name, price, rating, source: document.getElementById('mSource').value, comment: document.getElementById('mComment').value, user_name: myName }; 

                if (imgUrl) p.img_url = imgUrl; 

                if (editingId) await client.from('masks').update(p).eq('id', editingId); 

                else await client.from('masks').insert([p]); 

                location.reload(); 

            } catch (e) { alert("éŒ¯èª¤"); } 

        } 

        function startEdit(id, n, p, r, s, c) { editingId = id; document.getElementById('mName').value = n; document.getElementById('mPrice').value = p; document.getElementById('mRating').value = r; document.getElementById('mSource').value = s; document.getElementById('mComment').value = c; document.getElementById('formTitle').innerText = "âœï¸ ä¿®æ­£è³‡æ–™"; closeAllDrawers(); } 

        async function deleteItem(id) { if (confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) { await client.from('masks').delete().eq('id', id); location.reload(); } } 

        initApp(); 

    </script> 

</body> 

</html> 
