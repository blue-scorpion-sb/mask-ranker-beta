<!DOCTYPE html> 

<html lang="zh-HK"> 

<head> 

    <meta charset="UTF-8"> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 

    <title>Mask Ranker beta âœ¨</title> 

    <script src="https://cdn.tailwindcss.com"></script> 

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 

    <style> 

        /* åŸºç¤å­—é«”èª¿å¤§ */ 

        body { font-size: 1.15rem; }  

        .quadrant-bg { background-size: 25px 25px; background-image: radial-gradient(circle, #fbcfe8 1.5px, transparent 1.5px); } 

        .mask-node { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 30; cursor: pointer; -webkit-tap-highlight-color: transparent; } 

         

        .tooltip {  

            position: absolute; bottom: 130%; width: 85vw; max-width: 280px; background: rgba(15, 23, 42, 0.98);  

            backdrop-filter: blur(12px); color: white; padding: 1.5rem; border-radius: 1.5rem;  

            opacity: 0; visibility: hidden; transition: all 0.2s ease; z-index: 200; pointer-events: none; 

            box-shadow: 0 15px 30px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); 

        } 

        .tooltip-down { bottom: auto; top: 130%; } 

        .mask-node:hover .tooltip, .mask-node:active .tooltip { opacity: 1; visibility: visible; pointer-events: auto; } 

         

        .outer-label { font-size: 15px; font-weight: 900; color: #f472b6; position: absolute; white-space: nowrap; z-index: 40;} 

        .axis-label { font-size: 12px; font-weight: 800; color: #94a3b8; position: absolute; text-transform: uppercase; letter-spacing: 0.1em; z-index: 50; } 

        .btn-action { pointer-events: auto; cursor: pointer; padding: 6px; font-size: 1.2rem; } 

    </style> 

</head> 

<body class="bg-pink-50/30 min-h-screen pb-20 font-sans text-slate-800 overflow-x-hidden text-lg"> 

 

    <div class="max-w-7xl mx-auto p-4 md:p-6 pt-6"> 

        <header class="flex justify-between items-center mb-8 border-b-2 border-pink-200 pb-4"> 

            <div class="flex items-center gap-4"> 

                <button onclick="toggleSettings()" class="bg-white p-3 rounded-xl shadow-sm border border-pink-100 text-2xl">âš™ï¸</button> 

                <h1 class="text-3xl font-black text-pink-600 tracking-tighter italic">Mask Ranker <span class="text-sm font-bold text-slate-400 not-italic">beta</span></h1> 

            </div> 

            <div id="displayUserName" class="text-xs bg-white px-4 py-2 rounded-full border border-pink-200 font-bold text-pink-500 truncate max-w-[150px]">ğŸ‘¤ è¼‰å…¥ä¸­...</div> 

        </header> 

 

        <div id="settingsPanel" class="hidden bg-indigo-950 text-white p-6 rounded-[2rem] mb-8 shadow-2xl border-4 border-indigo-400"> 

            <div class="grid grid-cols-2 gap-6"> 

                <div class="space-y-3"> 

                    <p class="text-pink-400 text-sm font-bold uppercase tracking-widest">ğŸ’° åƒ¹éŒ¢ä¸Šé™/åˆ†ç•Œ</p> 

                    <input type="number" id="limitPrice" class="w-full bg-white/10 rounded-xl p-3 text-lg" value="16" oninput="renderCurrentData()"> 

                    <input type="number" id="splitPrice" class="w-full bg-white/10 rounded-xl p-3 text-lg" value="8" oninput="renderCurrentData()"> 

                </div> 

                <div class="space-y-3"> 

                    <p class="text-pink-400 text-sm font-bold uppercase tracking-widest">â­ è©•åˆ†ä¸Šé™/åˆ†ç•Œ</p> 

                    <input type="number" id="limitRating" class="w-full bg-white/10 rounded-xl p-3 text-lg" value="10" oninput="renderCurrentData()"> 

                    <input type="number" id="splitRating" class="w-full bg-white/10 rounded-xl p-3 text-lg" value="5" oninput="renderCurrentData()"> 

                </div> 

            </div> 

        </div> 

 

        <div class="flex flex-col lg:flex-row gap-12"> 

            <div class="lg:w-1/3 order-2 lg:order-1"> 

                <div id="inputCard" class="bg-white p-8 rounded-[2.5rem] shadow-xl border-2 border-pink-100"> 

                    <h2 id="formTitle" class="text-2xl font-black mb-6 text-indigo-950 italic">ğŸš€ è©•æ¸¬é¢è†œ</h2> 

                    <div class="space-y-4"> 

                        <input type="text" id="mName" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none border-2 border-transparent focus:border-pink-200" placeholder="ğŸ·ï¸ é¢è†œå…¨å"> 

                        <div class="grid grid-cols-2 gap-4"> 

                            <input type="number" id="mPrice" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none" placeholder="ğŸ’° åƒ¹éŒ¢"> 

                            <input type="number" id="mRating" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none" placeholder="â­ è©•åˆ† 1-10"> 

                        </div> 

                        <textarea id="mComment" maxlength="20" rows="1" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none" placeholder="ğŸ’¬ ç°¡çŸ­è©•èª (20å­—)"></textarea> 

                        <input type="file" id="mImg" accept="image/*" class="text-sm w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-pink-50 file:text-pink-700"> 

                        <div class="flex gap-3 pt-2"> 

                            <button onclick="saveData()" id="saveBtn" class="flex-1 bg-indigo-950 text-white font-black py-5 rounded-2xl shadow-lg active:scale-95 transition-transform text-xl">ç™¼å¸ƒè©•æ¸¬ â˜ï¸</button> 

                            <button onclick="cancelEdit()" id="cancelBtn" class="hidden px-6 bg-slate-100 rounded-2xl font-bold text-slate-400">X</button> 

                        </div> 

                    </div> 

                </div> 

            </div> 

 

            <div class="lg:w-2/3 order-1 lg:order-2"> 

                <div class="relative px-4 pt-6 pb-10"> 

                    <div class="outer-label -top-2 left-6 text-red-500">ğŸ’¸ æµªè²»é‡‘éŒ¢</div> 

                    <div class="outer-label -top-2 right-6 text-emerald-600">ğŸ’ è²´å©¦é¦–é¸</div> 

                    <div class="outer-label -bottom-2 left-6 text-slate-500">ğŸ’¤ å¹³åƒ¹ç²—ç”¨</div> 

                    <div class="outer-label -bottom-2 right-6 text-blue-600">ğŸ”¥ æ€§åƒ¹æ¯”ç‹</div> 

 

                    <div class="relative bg-white rounded-[3rem] shadow-2xl border-8 border-white overflow-visible aspect-square ring-4 ring-pink-100/50"> 

                        <div id="gridLayer" class="absolute inset-0 rounded-[2.5rem] overflow-hidden quadrant-bg"> 

                            <div id="yLine" class="absolute h-full w-[2px] bg-pink-400/30"></div> 

                            <div id="xLine" class="absolute w-full h-[2px] bg-pink-400/30"></div> 

                        </div> 

                        <div id="chartArea" class="absolute inset-0 z-30 p-6"></div> 

                    </div> 

                </div> 

            </div> 

        </div> 

    </div> 

 

    <script> 

        const SB_URL = 'https://ayulzvrljioqcfoqrsev.supabase.co ';  

        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dWx6dnJsamlvcWNmb3Fyc2V2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNzk3MzUsImV4cCI6MjA4NDk1NTczNX0.3iCIGRfR42cg12qoE5IUHb0EFn1yq9dDqAW-jcFmQDo'; 

        let client, myName = localStorage.getItem('mask_username'), editingId = null, cachedData = []; 

 

        async function initApp() { 

            if (!window.supabase || SB_URL.includes('YOUR_')) return; 

            client = window.supabase.createClient(SB_URL, SB_KEY); 

            if (!myName) { 

                myName = prompt("è«‹è¼¸å…¥ä½ çš„åå­—ï¼š") || "é¢è†œå¤§å¸«"; 

                localStorage.setItem('mask_username', myName); 

            } 

            document.getElementById('displayUserName').innerText = "ğŸ‘¤ " + myName; 

            await loadData(); 

            setInterval(loadData, 15000); 

        } 

 

        async function loadData() { 

            const { data, error } = await client.from('masks').select('*').order('created_at', { ascending: false }); 

            if (!error) { cachedData = data; renderCurrentData(); } 

        } 

 

        function renderCurrentData() { 

            const area = document.getElementById('chartArea'); 

            area.innerHTML = ''; 

             

            const limitP = parseFloat(document.getElementById('limitPrice').value) || 16; 

            const limitR = parseFloat(document.getElementById('limitRating').value) || 10; 

            const splitP = parseFloat(document.getElementById('splitPrice').value) || 8; 

            const splitR = parseFloat(document.getElementById('splitRating').value) || 5; 

 

            document.getElementById('yLine').style.left = `${((splitR - 1) / (limitR - 1)) * 100}%`; 

            document.getElementById('xLine').style.top = `${(1 - (splitP / limitP)) * 100}%`; 

 

            cachedData.forEach(m => { 

                const x = ((m.rating - 1) / (limitR - 1)) * 100; 

                const y = (1 - (m.price / limitP)) * 100; 

                 

                const node = document.createElement('div'); 

                node.className = "mask-node absolute w-14 h-14 -ml-7 -mt-7 pointer-events-auto"; 

                node.style.left = `${Math.max(8, Math.min(x, 92))}%`; 

                node.style.top = `${Math.max(8, Math.min(y, 92))}%`; 

 

                let ttStyle = "left: 50%; transform: translateX(-50%);"; 

                if (x > 65) ttStyle = "right: -10px; left: auto; transform: translateX(0);"; 

                if (x < 35) ttStyle = "left: -10px; transform: translateX(0);"; 

                const verticalClass = y < 25 ? "tooltip-down" : ""; 

 

                node.innerHTML = ` 

                    <div class="w-full h-full rounded-2xl border-[3px] shadow-lg overflow-hidden bg-white ${m.user_name === myName ? 'border-pink-500 ring-4 ring-pink-100' : 'border-indigo-400'}"> 

                        ${m.img_url ? `<img src="${m.img_url}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center font-black text-slate-200 text-2xl uppercase">${m.name.substring(0,1)}</div>`} 

                    </div> 

                    <div class="tooltip ${verticalClass}" style="${ttStyle}"> 

                        <div class="flex justify-between items-start mb-3"> 

                            <p class="font-black text-pink-400 text-xl leading-tight break-words whitespace-normal pr-4 flex-1">${m.name}</p> 

                            <div class="flex gap-2 shrink-0"> 

                                <button onclick="startEdit(${m.id}, '${m.name.replace(/'/g, "\\'")}', ${m.price}, ${m.rating}, '', '${(m.comment || '').replace(/'/g, "\\'")}')" class="btn-action">âœï¸</button> 

                                <button onclick="deleteItem(${m.id}, '${m.name.replace(/'/g, "\\'")}')" class="btn-action">ğŸ—‘ï¸</button> 

                            </div> 

                        </div> 

                        <div class="grid grid-cols-2 gap-3 text-lg mb-4 border-b border-white/10 pb-3"> 

                            <div><span class="text-white/40">ğŸ’°</span> $${m.price}</div> 

                            <div><span class="text-white/40">â­</span> ${m.rating}/10</div> 

                        </div> 

                        <p class="text-base italic text-slate-200 leading-relaxed break-words">"${m.comment || 'å†‡è©•èª'}"</p> 

                        <p class="text-xs text-white/20 mt-3 text-right">by ${m.user_name}</p> 

                    </div> 

                `; 

                area.appendChild(node); 

            }); 

        } 

 

        async function saveData() { 

            const name = document.getElementById('mName').value; 

            const price = parseFloat(document.getElementById('mPrice').value); 

            const rating = parseFloat(document.getElementById('mRating').value); 

            const comment = document.getElementById('mComment').value; 

            const imgFile = document.getElementById('mImg').files[0]; 

            if (!name || isNaN(price) || isNaN(rating)) return alert("è«‹å¡«å¥½åç¨±ã€åƒ¹éŒ¢åŒè©•åˆ†å…ˆï¼ğŸ’…"); 

            const btn = document.getElementById('saveBtn'); btn.disabled = true; btn.innerText = "ä¸Šå‚³ä¸­..."; 

            try { 

                let payload = { name, price, rating, comment, user_name: myName }; 

                if (imgFile) payload.img_url = await new Promise(r => { const f = new FileReader(); f.onload = e => r(e.target.result); f.readAsDataURL(imgFile); }); 

                if (editingId) await client.from('masks').update(payload).eq('id', editingId); 

                else await client.from('masks').insert([payload]); 

                cancelEdit(); await loadData(); 

            } catch (err) { alert(err.message); } finally { btn.disabled = false; btn.innerText = "ç™¼å¸ƒè©•æ¸¬ â˜ï¸"; } 

        } 

 

        async function deleteItem(id, name) { 

            if (confirm(`ç¢ºå®šåˆªé™¤ã€Œ${name}ã€ï¼Ÿ`)) { await client.from('masks').delete().eq('id', id); await loadData(); } 

        } 

 

        function startEdit(id, name, price, rating, source, comment) { 

            editingId = id; document.getElementById('mName').value = name; document.getElementById('mPrice').value = price; 

            document.getElementById('mRating').value = rating; document.getElementById('mComment').value = comment || ''; 

            document.getElementById('formTitle').innerText = "âœï¸ ç·¨è¼¯è©•æ¸¬"; document.getElementById('saveBtn').innerText = "æ›´æ–°è³‡æ–™ ğŸ’¾"; 

            document.getElementById('cancelBtn').classList.remove('hidden'); 

            window.scrollTo({ top: document.getElementById('inputCard').offsetTop - 20, behavior: 'smooth' }); 

        } 

 

        function cancelEdit() { 

            editingId = null; ["mName", "mPrice", "mRating", "mComment", "mImg"].forEach(id => document.getElementById(id).value = ''); 

            document.getElementById('formTitle').innerText = "ğŸš€ è©•æ¸¬é¢è†œ"; document.getElementById('saveBtn').innerText = "ç™¼å¸ƒè©•æ¸¬ â˜ï¸"; 

            document.getElementById('cancelBtn').classList.add('hidden'); 

        } 

 

        function toggleSettings() { document.getElementById('settingsPanel').classList.toggle('hidden'); } 

        initApp(); 

    </script> 

</body> 

</html> 
