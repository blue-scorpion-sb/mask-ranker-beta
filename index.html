<!DOCTYPE html> 

<html lang="zh-HK"> 

<head> 

    <meta charset="UTF-8"> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 

    <title>é¢è†œåˆ†æå¤§å¸« âœ¨</title> 

    <script src="https://cdn.tailwindcss.com"></script> 

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 

    <style> 

        body { font-size: 14px; background: #fff5f7; font-family: system-ui, -apple-system, sans-serif; overflow-x: hidden; } 

        .quadrant-bg { background-size: 20px 20px; background-image: radial-gradient(circle, #fbcfe8 1px, transparent 1px); } 

        .outer-label { font-size: 0.8rem; font-weight: 800; position: absolute; z-index: 40; pointer-events: none; padding: 4px 8px; border-radius: 6px; background: rgba(255,255,255,0.85); backdrop-filter: blur(4px); } 

        .label-tl { top: 0.8rem; left: 0.8rem; color: #ef4444; border-left: 4px solid #ef4444; } 

        .label-tr { top: 0.8rem; right: 0.8rem; color: #8b5cf6; border-right: 4px solid #8b5cf6; } 

        .label-bl { bottom: 0.8rem; left: 0.8rem; color: #64748b; border-left: 4px solid #64748b; } 

        .label-br { bottom: 0.8rem; right: 0.8rem; color: #db2777; border-right: 4px solid #db2777; } 

        #infoDrawer { position: fixed; background: #1e293b; color: white; z-index: 5000; transition: transform 0.3s ease-out; box-shadow: 0 0 40px rgba(0,0,0,0.3); overflow-y: auto; } 

        @media (max-width: 767px) { #infoDrawer { bottom: 0; left: 0; right: 0; height: 80vh; border-top-left-radius: 2rem; border-top-right-radius: 2rem; transform: translateY(100%); padding: 1.5rem; } #infoDrawer.open { transform: translateY(0); } } 

        @media (min-width: 768px) { #infoDrawer { top: 0; right: 0; bottom: 0; width: 380px; transform: translateX(100%); padding: 2.5rem 2rem; } #infoDrawer.open { transform: translateX(0); } } 

        .mask-node { cursor: pointer; z-index: 100; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); } 

        .mask-node:hover { z-index: 2000 !important; transform: scale(1.15); } 

        .active-node { z-index: 2100 !important; } 

        .active-node .node-inner { border: 3px solid #ec4899 !important; box-shadow: 0 0 15px rgba(236,72,153,0.5); transform: scale(1.1); } 

        .axis-line { position: absolute; background: rgba(244, 114, 182, 0.3); pointer-events: none; } 

         

        /* Setting Popup æ”¹ç‚ºå¾ Header å½ˆå‡º */ 

        #settingsPopup { display: none; position: absolute; top: 4.5rem; right: 1.5rem; background: white; padding: 1.2rem; border-radius: 1.2rem; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); z-index: 3000; border: 1px solid #fee2e2; width: 220px; } 

        #settingsPopup.open { display: block; animation: scaleIn 0.2s ease-out; } 

        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } } 

    </style> 

</head> 

<body onclick="closeAllDrawers(); closeSettings()" class="p-4 md:p-6"> 

 

    <div class="max-w-[1300px] mx-auto relative"> 

        <header class="mb-4 flex items-center justify-between gap-2"> 

            <div class="flex items-baseline gap-2"> 

                <h1 class="text-2xl font-black text-pink-600 italic leading-none">é¢è†œåˆ†æå¤§å¸«</h1> 

                <span class="text-[10px] text-pink-400 font-bold border border-pink-200 px-1.5 rounded uppercase">Beta</span> 

            </div> 

             

            <div class="flex items-center gap-2"> 

                <div onclick="event.stopPropagation(); changeName()" class="bg-white/60 hover:bg-white px-3 py-2 rounded-full border border-pink-100 cursor-pointer transition-all flex items-center gap-2 group"> 

                    <span class="text-[11px] font-bold text-slate-400 group-hover:text-pink-500">åˆ†æå¸«:</span> 

                    <span id="userNameDisplay" class="text-xs font-black text-pink-600">è¼‰å…¥ä¸­...</span> 

                </div> 

                <button onclick="event.stopPropagation(); toggleSettings()" class="w-9 h-9 bg-white shadow-sm rounded-full flex items-center justify-center border border-pink-100 hover:border-pink-300 hover:bg-pink-50 transition-all text-lg"> 

                    âš™ï¸ 

                </button> 

            </div> 

        </header> 

 

        <div id="settingsPopup" onclick="event.stopPropagation()"> 

            <p class="text-[10px] font-black text-pink-400 uppercase mb-3 tracking-widest">Chart Settings</p> 

            <div class="space-y-4"> 

                <div> 

                    <label class="text-[10px] font-bold text-slate-400 ml-1">åƒ¹æ ¼ä¸Šé™ (Y-Axis Max)</label> 

                    <input type="number" id="setLimitP" inputmode="decimal" onchange="updateSettings()" class="w-full bg-slate-50 rounded-lg p-2.5 text-xs outline-none border border-transparent focus:border-pink-200 mt-1"> 

                </div> 

                <div> 

                    <label class="text-[10px] font-bold text-slate-400 ml-1">å¹³è²´åˆ†å‰²ç·š ($)</label> 

                    <input type="number" id="setSplitP" inputmode="decimal" onchange="updateSettings()" class="w-full bg-slate-50 rounded-lg p-2.5 text-xs outline-none border border-transparent focus:border-pink-200 mt-1"> 

                </div> 

            </div> 

        </div> 

 

        <div class="flex flex-col lg:flex-row gap-4 items-start"> 

            <div class="w-full lg:w-[300px] shrink-0 order-2 lg:order-1" onclick="event.stopPropagation()"> 

                <div class="bg-white p-5 rounded-[1.8rem] shadow-lg border border-pink-50 sticky top-6"> 

                    <h2 id="formTitle" class="text-lg font-black mb-4 text-slate-800">ğŸš€ è©•æ¸¬é¢è†œ</h2> 

                    <div class="space-y-3"> 

                        <input type="text" id="mName" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none border-2 border-transparent focus:border-pink-200" placeholder="ğŸ·ï¸ é¢è†œåç¨±"> 

                        <div class="grid grid-cols-2 gap-2"> 

                            <input type="number" id="mPrice" inputmode="decimal" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="ğŸ’° åƒ¹éŒ¢"> 

                            <select id="mRating" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none text-slate-500 appearance-none cursor-pointer"> 

                                <option value="" disabled selected>â­ è©•åˆ†</option> 

                                <option value="1">1 åˆ†</option><option value="2">2 åˆ†</option><option value="3">3 åˆ†</option><option value="4">4 åˆ†</option> 

                                <option value="5">5 åˆ†</option><option value="6">6 åˆ†</option><option value="7">7 åˆ†</option><option value="8">8 åˆ†</option> 

                                <option value="9">9 åˆ†</option><option value="10">10 åˆ†</option> 

                            </select> 

                        </div> 

                        <input type="text" id="mSource" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="ğŸ“ è³¼å…¥åœ°é»"> 

                        <textarea id="mComment" maxlength="20" rows="1" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none resize-none" placeholder="ğŸ’¬ çŸ­è©• (20å­—)"></textarea> 

                         

                        <label for="mImg" class="flex flex-col items-center justify-center w-full h-16 border-2 border-dashed border-pink-100 rounded-xl cursor-pointer bg-pink-50/30 overflow-hidden relative transition-colors hover:bg-pink-50"> 

                            <img id="imgPreview" class="absolute inset-0 w-full h-full object-cover hidden"> 

                            <div id="uploadPrompt" class="text-center text-pink-300"> 

                                <span class="text-lg">ğŸ“¸</span> 

                                <p class="text-[8px] font-bold uppercase">ä¸Šå‚³åœ–ç‰‡</p> 

                            </div> 

                            <input type="file" id="mImg" accept="image/*" class="hidden" onchange="handleImageSelect(this)"> 

                        </label> 

                         

                        <button onclick="saveData()" id="saveBtn" class="w-full bg-pink-600 text-white font-black py-3.5 rounded-xl shadow-md active:scale-95 transition-all text-sm">ç™¼å¸ƒåˆ†æ</button> 

                    </div> 

                </div> 

            </div> 

 

            <div class="flex-1 w-full order-1 lg:order-2"> 

                <div id="pinch-viewport" class="aspect-square max-h-[78vh] shadow-xl overflow-hidden rounded-[1.8rem] bg-white border-4 border-white relative"> 

                    <div id="canvas-area" class="quadrant-bg w-full h-full relative"> 

                        <div class="outer-label label-tl">ğŸ’¸ æµªè²»é‡‘éŒ¢</div> 

                        <div class="outer-label label-tr">ğŸ’ è²´å©¦ä¹‹é¸</div> 

                        <div class="outer-label label-bl">ğŸ’¤ å¹³åƒ¹ç²—ç”¨</div> 

                        <div class="outer-label label-br">âœ¨ å¿…é ˆå›è³¼</div> 

                        <div id="yLine" class="axis-line h-[calc(100%-40px)] w-[2px] top-[20px]"></div> 

                        <div id="xLine" class="axis-line w-[calc(100%-40px)] h-[2px] left-[20px]"></div> 

                        <div id="chartArea" class="absolute inset-0 p-8 md:p-12"></div> 

                    </div> 

                </div> 

            </div> 

        </div> 

    </div> 

 

    <div id="infoDrawer" onclick="event.stopPropagation()"> 

        <button onclick="closeAllDrawers()" class="absolute top-5 right-5 text-white/50 hover:text-white text-xl">âœ•</button> 

        <div id="drawerContent"></div> 

    </div> 

 

    <script> 

        const SB_URL = 'https://ayulzvrljioqcfoqrsev.supabase.co'; 

        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dWx6dnJsamlvcWNmb3Fyc2V2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNzk3MzUsImV4cCI6MjA4NDk1NTczNX0.3iCIGRfR42cg12qoE5IUHb0EFn1yq9dDqAW-jcFmQDo'; 

        const client = supabase.createClient(SB_URL, SB_KEY); 

        let myName = localStorage.getItem('mask_username'), cachedData = [], editingId = null; 

        let limitP = 50, splitP = 25, isUserTuning = false; 

 

        async function initApp() { 

            if (!myName) { myName = prompt("åˆ†æå¸«å¤§åï¼Ÿ") || "åˆ†æå¸«" + Math.floor(Math.random()*100); localStorage.setItem('mask_username', myName); } 

            document.getElementById('userNameDisplay').innerText = myName; 

            await loadData(); 

            setInterval(loadData, 20000); 

        } 

 

        function changeName() { 

            const newName = prompt("æ›´æ”¹åç¨±ï¼š", myName); 

            if (newName) { myName = newName; localStorage.setItem('mask_username', myName); document.getElementById('userNameDisplay').innerText = myName; renderCurrentData(); } 

        } 

 

        async function loadData() { 

            const { data, error } = await client.from('masks').select('*').order('created_at', { ascending: false }); 

            if (!error) { 

                cachedData = data; 

                if (!isUserTuning && data.length > 0) { 

                    limitP = Math.ceil(Math.max(...data.map(m => m.price), 1)); 

                    splitP = limitP / 2; 

                    document.getElementById('setLimitP').value = limitP; 

                    document.getElementById('setSplitP').value = Math.round(splitP); 

                } 

                renderCurrentData(); 

            } 

        } 

 

        function toggleSettings() { document.getElementById('settingsPopup').classList.toggle('open'); } 

        function closeSettings() { document.getElementById('settingsPopup').classList.remove('open'); } 

        function updateSettings() { isUserTuning = true; limitP = parseFloat(document.getElementById('setLimitP').value) || 50; splitP = parseFloat(document.getElementById('setSplitP').value) || 25; renderCurrentData(); } 

 

        function renderCurrentData() { 

            const area = document.getElementById('chartArea'); area.innerHTML = ''; 

            cachedData.forEach((m, idx) => { 

                const xBase = 10 + (((m.rating - 1) / 9) * 80); 

                const yBase = 10 + ((1 - (m.price / limitP)) * 80); 

                const jitterX = (Math.random() - 0.5) * 5; 

                const jitterY = (Math.random() - 0.5) * 5; 

                const node = document.createElement('div'); 

                node.className = `mask-node absolute w-10 h-10 md:w-11 md:h-11 -ml-5 -mt-5 md:-ml-5.5 md:-mt-5.5`; 

                node.style.left = `${xBase + jitterX}%`; node.style.top = `${yBase + jitterY}%`; node.style.zIndex = 100 + idx; 

                node.onclick = (e) => { e.stopPropagation(); document.querySelectorAll('.mask-node').forEach(n => n.classList.remove('active-node')); node.classList.add('active-node'); showInfo(m); }; 

                node.innerHTML = `<div class="node-inner w-full h-full rounded-xl border-2 shadow-sm overflow-hidden bg-white ${m.user_name === myName ? 'border-pink-500' : 'border-slate-100'}"> 

                    ${m.img_url ? `<img src="${m.img_url}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center font-bold text-slate-200 text-[10px]">${m.name[0]}</div>`} 

                </div>`; 

                area.appendChild(node); 

            }); 

            updateAxis(); 

        } 

 

        function updateAxis() { 

            const pad = 20, w = viewport.clientWidth - (pad * 2), h = viewport.clientHeight - (pad * 2); 

            document.getElementById('yLine').style.left = `calc(${pad}px + ${4/9 * w}px)`; 

            document.getElementById('xLine').style.top = `calc(${pad}px + ${(1 - (splitP / limitP)) * h}px)`; 

        } 

 

        function showInfo(m) { 

            const drawer = document.getElementById('infoDrawer'); 

            document.getElementById('drawerContent').innerHTML = ` 

                <div class="w-full aspect-square rounded-2xl overflow-hidden bg-slate-800 mb-6 shadow-lg"> 

                    ${m.img_url ? `<img src="${m.img_url}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center text-4xl opacity-10">ğŸ“¸</div>`} 

                </div> 

                <div class="flex justify-between items-start mb-1"> 

                    <h3 class="text-xl font-black text-pink-400 leading-tight">${m.name}</h3> 

                    <div class="flex gap-4 text-lg"> 

                        <button onclick="startEdit(${m.id}, '${m.name.replace(/'/g, "\\'")}', ${m.price}, ${m.rating}, '${m.source}', '${m.comment}')">âœï¸</button> 

                        <button onclick="deleteItem(${m.id})" class="text-red-400">ğŸ—‘ï¸</button> 

                    </div> 

                </div> 

                <p class="text-[10px] font-bold opacity-30 uppercase mb-6 px-1">By ${m.user_name}</p> 

                <div class="grid grid-cols-2 gap-3 mb-4 text-white"> 

                    <div class="bg-white/5 p-4 rounded-2xl"><p class="text-[9px] opacity-30 mb-1 uppercase font-bold tracking-tighter">åƒ¹éŒ¢</p><p class="text-2xl font-black italic text-pink-50">$${m.price}</p></div> 

                    <div class="bg-white/5 p-4 rounded-2xl"><p class="text-[9px] opacity-30 mb-1 uppercase font-bold tracking-tighter">è©•åˆ†</p><p class="text-2xl font-black italic text-pink-50">${m.rating}/10</p></div> 

                </div> 

                <div class="bg-white/5 p-4 rounded-2xl mb-4 text-sm"><p class="text-[9px] opacity-30 mb-1 uppercase font-bold tracking-widest">è³¼å…¥åœ°é»</p><p class="font-medium text-pink-50">ğŸ“ ${m.source || '-'}</p></div> 

                <div class="bg-pink-600/10 p-5 rounded-2xl border border-pink-500/10"><p class="italic text-sm text-pink-50 leading-relaxed">"${m.comment || 'ç„¡è©•åƒ¹ã€‚'}"</p></div> 

            `; 

            drawer.classList.add('open'); 

        } 

 

        const viewport = document.getElementById('pinch-viewport'); 

        function closeAllDrawers() { document.getElementById('infoDrawer').classList.remove('open'); document.querySelectorAll('.mask-node').forEach(n => n.classList.remove('active-node')); } 

        function handleImageSelect(input) { if (input.files && input.files[0]) { const r = new FileReader(); r.onload = e => { document.getElementById('imgPreview').src = e.target.result; document.getElementById('imgPreview').classList.remove('hidden'); document.getElementById('uploadPrompt').classList.add('hidden'); }; r.readAsDataURL(input.files[0]); } } 

        async function saveData() { 

            const name = document.getElementById('mName').value, price = parseFloat(document.getElementById('mPrice').value), rating = parseInt(document.getElementById('mRating').value); 

            if (!name || isNaN(price) || isNaN(rating)) return alert("è«‹å¡«å¯«åç¨±ã€åƒ¹æ ¼åŠè©•åˆ†"); 

            try { 

                let imgUrl = ""; const imgFile = document.getElementById('mImg').files[0]; 

                if (imgFile) { 

                    const fileName = `${Date.now()}.jpg`; await client.storage.from('mask-images').upload(fileName, imgFile); 

                    imgUrl = client.storage.from('mask-images').getPublicUrl(fileName).data.publicUrl; 

                } 

                const p = { name, price, rating, source: document.getElementById('mSource').value, comment: document.getElementById('mComment').value, user_name: myName }; 

                if (imgUrl) p.img_url = imgUrl; 

                if (editingId) await client.from('masks').update(p).eq('id', editingId); 

                else await client.from('masks').insert([p]); 

                location.reload(); 

            } catch (e) { alert("å„²å­˜å¤±æ•—"); } 

        } 

        function startEdit(id, n, p, r, s, c) { editingId = id; document.getElementById('mName').value = n; document.getElementById('mPrice').value = p; document.getElementById('mRating').value = r; document.getElementById('mSource').value = s; document.getElementById('mComment').value = c; document.getElementById('formTitle').innerText = "âœï¸ ä¿®æ­£ç´€éŒ„"; closeAllDrawers(); window.scrollTo(0,0); } 

        async function deleteItem(id) { if (confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) { await client.from('masks').delete().eq('id', id); location.reload(); } } 

        initApp(); 

    </script> 

</body> 

</html> 
