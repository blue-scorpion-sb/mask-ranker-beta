<!DOCTYPE html> 

<html lang="zh-HK"> 

<head> 

    <meta charset="UTF-8"> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 

    <title>é¢è†œæˆ°ç¸¾è¡¨ Cloud âœ¨</title> 

    <script src="https://cdn.tailwindcss.com"></script> 

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 

    <style> 

        .quadrant-bg { background-size: 20px 20px; background-image: radial-gradient(circle, #fbcfe8 1px, transparent 1px); } 

        .mask-node { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 30; cursor: pointer; -webkit-tap-highlight-color: transparent; } 

         

        /* æ¨™æº– Tooltip (å‘ä¸Šå½ˆ) */ 

        .tooltip {  

            position: absolute; bottom: 130%; width: 85vw; max-width: 240px; background: rgba(15, 23, 42, 0.95);  

            backdrop-filter: blur(12px); color: white; padding: 1rem; border-radius: 1rem;  

            opacity: 0; visibility: hidden; transition: all 0.2s ease; z-index: 200; pointer-events: none; 

            box-shadow: 0 10px 20px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); 

        } 

        /* åè½‰ Tooltip (å‘ä¸‹å½ˆ - ç•¶å¤ªè¿‘é ‚éƒ¨æ™‚ç”¨) */ 

        .tooltip-down { bottom: auto; top: 130%; } 

 

        .mask-node:hover .tooltip, .mask-node:active .tooltip { opacity: 1; visibility: visible; pointer-events: auto; } 

         

        .outer-label { font-size: 12px; font-weight: 900; color: #f472b6; position: absolute; white-space: nowrap; z-index: 40;} 

        .axis-label { font-size: 10px; font-weight: 800; color: #94a3b8; position: absolute; text-transform: uppercase; letter-spacing: 0.1em; z-index: 50; } 

        .btn-action { pointer-events: auto; cursor: pointer; padding: 4px; } 

    </style> 

</head> 

<body class="bg-pink-50/30 min-h-screen pb-20 font-sans text-slate-800 overflow-x-hidden"> 

 

    <div class="max-w-7xl mx-auto p-4 md:p-6 pt-6"> 

        <header class="flex justify-between items-center mb-6 border-b-2 border-pink-200 pb-4"> 

            <div class="flex items-center gap-3"> 

                <button onclick="toggleSettings()" class="bg-white p-2 rounded-xl shadow-sm border border-pink-100 text-lg">âš™ï¸</button> 

                <h1 class="text-2xl font-black text-pink-600 tracking-tighter italic">MASK<span class="text-indigo-950">CLOUD</span></h1> 

            </div> 

            <div id="displayUserName" class="text-[10px] bg-white px-3 py-1 rounded-full border border-pink-200 font-bold text-pink-500 truncate max-w-[120px]">è¼‰å…¥ä¸­...</div> 

        </header> 

 

        <div id="settingsPanel" class="hidden bg-indigo-950 text-white p-5 rounded-[2rem] mb-6 shadow-2xl border-2 border-indigo-400 animate-in slide-in-from-top duration-300"> 

            <div class="grid grid-cols-2 gap-4"> 

                <div class="space-y-2"> 

                    <p class="text-pink-400 text-xs font-bold">ğŸ’° åƒ¹éŒ¢è¨­å®š</p> 

                    <input type="number" id="limitPrice" class="w-full bg-white/10 rounded-lg p-2 text-sm" value="16" oninput="renderCurrentData()"> 

                    <input type="number" id="splitPrice" class="w-full bg-white/10 rounded-lg p-2 text-sm" value="8" oninput="renderCurrentData()"> 

                </div> 

                <div class="space-y-2"> 

                    <p class="text-pink-400 text-xs font-bold">â­ è©•åˆ†è¨­å®š</p> 

                    <input type="number" id="limitRating" class="w-full bg-white/10 rounded-lg p-2 text-sm" value="10" oninput="renderCurrentData()"> 

                    <input type="number" id="splitRating" class="w-full bg-white/10 rounded-lg p-2 text-sm" value="5" oninput="renderCurrentData()"> 

                </div> 

            </div> 

        </div> 

 

        <div class="flex flex-col lg:flex-row gap-8"> 

            <div class="lg:w-1/3 order-2 lg:order-1"> 

                <div id="inputCard" class="bg-white p-6 rounded-[2rem] shadow-lg border border-pink-100"> 

                    <h2 id="formTitle" class="text-lg font-bold mb-4 text-indigo-950 italic">ğŸš€ è©•æ¸¬é¢è†œ</h2> 

                    <div class="space-y-3"> 

                        <input type="text" id="mName" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none border border-transparent focus:border-pink-200" placeholder="ğŸ·ï¸ åç¨±"> 

                        <div class="grid grid-cols-2 gap-3"> 

                            <input type="number" id="mPrice" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="ğŸ’° åƒ¹éŒ¢"> 

                            <input type="number" id="mRating" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="â­ 1-10"> 

                        </div> 

                        <input type="text" id="mComment" maxlength="20" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none" placeholder="ğŸ’¬ è©•èª (20å­—)"> 

                        <input type="file" id="mImg" accept="image/*" class="text-[10px] w-full"> 

                        <div class="flex gap-2"> 

                            <button onclick="saveData()" id="saveBtn" class="flex-1 bg-indigo-950 text-white font-black py-3 rounded-xl shadow-lg">ç™¼å¸ƒ â˜ï¸</button> 

                            <button onclick="cancelEdit()" id="cancelBtn" class="hidden px-4 bg-slate-100 rounded-xl text-xs">X</button> 

                        </div> 

                    </div> 

                </div> 

            </div> 

 

            <div class="lg:w-2/3 order-1 lg:order-2"> 

                <div class="relative px-4 pt-4 pb-8"> 

                    <div class="outer-label -top-2 left-4 text-red-500">ğŸ’¸ è²´/å»¢</div> 

                    <div class="outer-label -top-2 right-4 text-emerald-600">ğŸ’ è²´å©¦</div> 

                    <div class="outer-label -bottom-2 left-4 text-slate-500">ğŸ’¤ ç²—ç”¨</div> 

                    <div class="outer-label -bottom-2 right-4 text-blue-600">ğŸ”¥ æ­£å˜¢</div> 

 

                    <div class="relative bg-white rounded-[2.5rem] shadow-xl border-4 border-white overflow-visible aspect-square ring-2 ring-pink-100"> 

                        <div id="gridLayer" class="absolute inset-0 quadrant-bg rounded-[2rem] overflow-hidden"> 

                            <div id="yLine" class="absolute h-full w-[1px] bg-pink-400/40"></div> 

                            <div id="xLine" class="absolute w-full h-[1px] bg-pink-400/40"></div> 

                        </div> 

                        <div id="chartArea" class="absolute inset-0 z-30 p-4"></div> 

                    </div> 

                </div> 

            </div> 

        </div> 

    </div> 

 

    <script> 

        // --- è«‹ç¢ºä¿åœ¨æ­¤å¡«å…¥ä½ çš„ Supabase è³‡æ–™ --- 

        const SB_URL = 'https://ayulzvrljioqcfoqrsev.supabase.co ';  

        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dWx6dnJsamlvcWNmb3Fyc2V2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNzk3MzUsImV4cCI6MjA4NDk1NTczNX0.3iCIGRfR42cg12qoE5IUHb0EFn1yq9dDqAW-jcFmQDo'; 

        let client, myName = localStorage.getItem('mask_username'), editingId = null, cachedData = []; 

 

        async function initApp() { 

            if (!window.supabase || SB_URL.includes('YOUR_')) return; 

            client = window.supabase.createClient(SB_URL, SB_KEY); 

            if (!myName) { 

                myName = prompt("è«‹è¼¸å…¥ä½ çš„åå­—ï¼š") || "é¢è†œç¾çœ‰"; 

                localStorage.setItem('mask_username', myName); 

            } 

            document.getElementById('displayUserName').innerText = "ğŸ‘¤ " + myName; 

            await loadData(); 

            setInterval(loadData, 15000); 

        } 

 

        async function loadData() { 

            const { data, error } = await client.from('masks').select('*').order('created_at', { ascending: false }); 

            if (!error) { cachedData = data; renderCurrentData(); } 

        } 

 

        function renderCurrentData() { 

            const area = document.getElementById('chartArea'); 

            area.innerHTML = ''; 

             

            const limitP = parseFloat(document.getElementById('limitPrice').value) || 16; 

            const limitR = parseFloat(document.getElementById('limitRating').value) || 10; 

            const splitP = parseFloat(document.getElementById('splitPrice').value) || 8; 

            const splitR = parseFloat(document.getElementById('splitRating').value) || 5; 

 

            document.getElementById('yLine').style.left = `${((splitR - 1) / (limitR - 1)) * 100}%`; 

            document.getElementById('xLine').style.top = `${(1 - (splitP / limitP)) * 100}%`; 

 

            cachedData.forEach(m => { 

                const x = ((m.rating - 1) / (limitR - 1)) * 100; 

                const y = (1 - (m.price / limitP)) * 100; 

                 

                const node = document.createElement('div'); 

                node.className = "mask-node absolute w-12 h-12 -ml-6 -mt-6 pointer-events-auto"; 

                node.style.left = `${Math.max(8, Math.min(x, 92))}%`; 

                node.style.top = `${Math.max(8, Math.min(y, 92))}%`; 

 

                // 1. æ°´å¹³é¿ä½ 

                let ttStyle = "left: 50%; transform: translateX(-50%);"; 

                if (x > 65) ttStyle = "right: -10px; left: auto; transform: translateX(0);"; 

                if (x < 35) ttStyle = "left: -10px; transform: translateX(0);"; 

 

                // 2. å‚ç›´é¿ä½ (æ–°åŠŸèƒ½) 

                // å¦‚æœ y < 25 (å³ä¿‚å¤ªè¿‘é ‚éƒ¨), åŠ  'tooltip-down' class ä»¤ä½¢å‘ä¸‹å½ˆ 

                const verticalClass = y < 25 ? "tooltip-down" : ""; 

 

                node.innerHTML = ` 

                    <div class="w-full h-full rounded-xl border-2 shadow-sm overflow-hidden bg-white ${m.user_name === myName ? 'border-pink-400 ring-2 ring-pink-50' : 'border-indigo-400'}"> 

                        ${m.img_url ? `<img src="${m.img_url}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center font-bold text-slate-300 uppercase">${m.name.substring(0,1)}</div>`} 

                    </div> 

                    <div class="tooltip ${verticalClass}" style="${ttStyle}"> 

                        <div class="flex justify-between items-start mb-2"> 

                            <p class="font-black text-pink-400 text-sm truncate uppercase pr-2">${m.name}</p> 

                            <div class="flex gap-1 shrink-0"> 

                                <button onclick="startEdit(${m.id}, '${m.name.replace(/'/g, "\\'")}', ${m.price}, ${m.rating}, '', '${(m.comment || '').replace(/'/g, "\\'")}')" class="btn-action">âœï¸</button> 

                                <button onclick="deleteItem(${m.id}, '${m.name.replace(/'/g, "\\'")}')" class="btn-action">ğŸ—‘ï¸</button> 

                            </div> 

                        </div> 

                        <div class="grid grid-cols-2 gap-2 text-[10px] mb-2 border-b border-white/10 pb-2"> 

                            <div><span class="text-white/40">ğŸ’°</span> $${m.price}</div> 

                            <div><span class="text-white/40">â­</span> ${m.rating}</div> 

                        </div> 

                        <p class="text-[10px] italic text-slate-300 leading-tight break-words">"${m.comment || '...'}"</p> 

                        <p class="text-[9px] text-white/20 mt-1 text-right truncate">by ${m.user_name}</p> 

                    </div> 

                `; 

                area.appendChild(node); 

            }); 

        } 

 

        async function saveData() { 

            const name = document.getElementById('mName').value; 

            const price = parseFloat(document.getElementById('mPrice').value); 

            const rating = parseFloat(document.getElementById('mRating').value); 

            const comment = document.getElementById('mComment').value; 

            const imgFile = document.getElementById('mImg').files[0]; 

            if (!name || isNaN(price) || isNaN(rating)) return alert("å¡«å¥½è³‡æ–™å…ˆï¼ğŸ’…"); 

            const btn = document.getElementById('saveBtn'); btn.disabled = true; 

            try { 

                let payload = { name, price, rating, comment, user_name: myName }; 

                if (imgFile) payload.img_url = await new Promise(r => { const f = new FileReader(); f.onload = e => r(e.target.result); f.readAsDataURL(imgFile); }); 

                if (editingId) await client.from('masks').update(payload).eq('id', editingId); 

                else await client.from('masks').insert([payload]); 

                cancelEdit(); await loadData(); 

            } catch (err) { alert(err.message); } finally { btn.disabled = false; } 

        } 

 

        async function deleteItem(id, name) { 

            if (confirm(`ç¢ºå®šåˆªé™¤ã€Œ${name}ã€ï¼Ÿ`)) { await client.from('masks').delete().eq('id', id); await loadData(); } 

        } 

 

        function startEdit(id, name, price, rating, source, comment) { 

            editingId = id; document.getElementById('mName').value = name; document.getElementById('mPrice').value = price; 

            document.getElementById('mRating').value = rating; document.getElementById('mComment').value = comment || ''; 

            document.getElementById('formTitle').innerText = "âœï¸ ä¿®æ”¹ä¸­"; document.getElementById('saveBtn').innerText = "æ›´æ–°"; 

            document.getElementById('cancelBtn').classList.remove('hidden'); 

        } 

 

        function cancelEdit() { 

            editingId = null; ["mName", "mPrice", "mRating", "mComment", "mImg"].forEach(id => document.getElementById(id).value = ''); 

            document.getElementById('formTitle').innerText = "ğŸš€ è©•æ¸¬é¢è†œ"; document.getElementById('saveBtn').innerText = "ç™¼å¸ƒ â˜ï¸"; 

            document.getElementById('cancelBtn').classList.add('hidden'); 

        } 

 

        function toggleSettings() { document.getElementById('settingsPanel').classList.toggle('hidden'); } 

        initApp(); 

    </script> 

</body> 

</html> 
