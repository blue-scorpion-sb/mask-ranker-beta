<!DOCTYPE html> 

<html lang="zh-HK"> 

<head> 

    <meta charset="UTF-8"> 

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 

    <title>Mask Ranker beta âœ¨</title> 

    <script src="https://cdn.tailwindcss.com"></script> 

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 

    <style> 

        body { font-size: 1.15rem; }  

        .quadrant-bg { background-size: 25px 25px; background-image: radial-gradient(circle, #fbcfe8 1.5px, transparent 1.5px); } 

        .outer-label { font-size: 15px; font-weight: 900; color: #f472b6; position: absolute; white-space: nowrap; z-index: 1; pointer-events: none;} 

        .chart-container { z-index: 10; position: relative; } 

        .mask-node { transition: all 0.2s ease; z-index: 20; cursor: pointer; -webkit-tap-highlight-color: transparent; } 

        .mask-node.active-node { z-index: 999 !important; } 

        .mask-node.active-node > div:first-child { transform: scale(1.15); border-color: #ec4899; box-shadow: 0 0 25px rgba(236, 72, 153, 0.4); } 

 .axis-label {  

    font-size: 12px;  

    font-weight: 800;  

    color: #db2777; /* æ·±ç²‰ç´…ï¼Œæ›´æ˜“ç‡ */ 

    position: absolute;  

    z-index: 50;  

    pointer-events: none; 

    background: white;  

    padding: 2px 6px; 

    border: 1px solid #fbcfe8; 

    border-radius: 6px; 

    box-shadow: 0 2px 4px rgba(0,0,0,0.05); 

    white-space: nowrap; 
} 

        .tooltip {  

            position: absolute; bottom: 135%; width: 85vw; max-width: 300px; background: rgba(15, 23, 42, 0.98);  

            backdrop-filter: blur(15px); color: white; padding: 1.5rem; border-radius: 1.5rem;  

            opacity: 0; visibility: hidden; transition: all 0.2s ease; pointer-events: none; 

            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6); border: 1px solid rgba(255,255,255,0.15); 

        } 

        .tooltip-down { bottom: auto; top: 135%; } 

        .active-node .tooltip { opacity: 1; visibility: visible; pointer-events: auto; } 

        .btn-action { pointer-events: auto; cursor: pointer; padding: 10px; font-size: 1.4rem; } 

    </style> 

</head> 

<body class="bg-pink-50/30 min-h-screen pb-20 font-sans text-slate-800 overflow-x-hidden text-lg" onclick="closeAllTooltips()"> 

 

    <div class="max-w-7xl mx-auto p-4 md:p-6 pt-6"> 

        <header class="flex justify-between items-center mb-8 border-b-2 border-pink-200 pb-4"> 

            <div class="flex items-center gap-4"> 

                <button onclick="event.stopPropagation(); toggleSettings()" class="bg-white p-3 rounded-xl shadow-sm border border-pink-100 text-2xl">âš™ï¸</button> 

                <h1 class="text-3xl font-black text-pink-600 tracking-tighter italic">Mask Ranker <span class="text-sm font-bold text-slate-400 not-italic">beta</span></h1> 

            </div> 

            <div id="displayUserName" class="text-xs bg-white px-4 py-2 rounded-full border border-pink-200 font-bold text-pink-500">ğŸ‘¤ è¼‰å…¥ä¸­...</div> 

        </header> 

 

        <div id="settingsPanel" class="hidden bg-indigo-950 text-white p-6 rounded-[2.5rem] mb-8 shadow-2xl border-4 border-indigo-400" onclick="event.stopPropagation()"> 

            <div class="grid grid-cols-2 gap-6"> 

                <div class="space-y-3"> 

                    <p class="text-pink-400 text-sm font-bold uppercase">ğŸ’° åƒ¹éŒ¢åœ–è¡¨ä¸Šé™</p> 

                    <input type="number" id="limitPrice" class="w-full bg-white/10 rounded-xl p-3 text-lg outline-none" value="16" oninput="renderCurrentData()"> 

                    <p class="text-pink-400 text-sm font-bold uppercase">ğŸ’° åƒ¹éŒ¢ä¸­ç·šè¡¨ç¤º</p> 

                    <input type="number" id="splitPrice" class="w-full bg-white/10 rounded-xl p-3 text-lg outline-none" value="8" oninput="renderCurrentData()"> 

                </div> 

                <div class="space-y-3"> 

                    <p class="text-pink-400 text-sm font-bold uppercase">â­ è©•åˆ†åœ–è¡¨ä¸Šé™</p> 

                    <input type="number" id="limitRating" class="w-full bg-white/10 rounded-xl p-3 text-lg outline-none" value="10" oninput="renderCurrentData()"> 
                    
                     <p class="text-pink-400 text-sm font-bold uppercase">â­ è©•åˆ†ä¸­ç·šè¡¨ç¤º</p> 

                    <input type="number" id="splitRating" class="w-full bg-white/10 rounded-xl p-3 text-lg outline-none" value="5" oninput="renderCurrentData()"> 

                </div> 

            </div> 

        </div> 

 

        <div class="flex flex-col lg:flex-row gap-10"> 

            <div class="lg:w-1/3 order-2 lg:order-1" onclick="event.stopPropagation()"> 

                <div id="inputCard" class="bg-white p-8 rounded-[2.5rem] shadow-xl border-2 border-pink-100"> 

                    <h2 id="formTitle" class="text-2xl font-black mb-6 text-indigo-950 italic">ğŸš€ è©•æ¸¬é¢è†œ</h2> 

                    <div class="space-y-4"> 

                        <input type="text" id="mName" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none border-2 border-transparent focus:border-pink-200" placeholder="ğŸ·ï¸ é¢è†œå…¨å"> 

                        <div class="grid grid-cols-2 gap-4"> 

                            <input type="number" id="mPrice" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none border-2 border-transparent focus:border-pink-200" placeholder="ğŸ’° å–®ç‰‡åƒ¹éŒ¢"> 

                            <input type="number" id="mRating" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none border-2 border-transparent focus:border-pink-200" placeholder="â­ è©•åˆ† 1-10"> 

                        </div> 

                        <input type="text" id="mSource" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none border-2 border-transparent focus:border-pink-200" placeholder="ğŸ“ è³¼å…¥åœ°é» (ä¾‹å¦‚: è¬å¯§)"> 

                        <textarea id="mComment" maxlength="20" rows="1" class="w-full bg-slate-50 rounded-2xl p-4 text-lg outline-none border-2 border-transparent focus:border-pink-200" placeholder="ğŸ’¬ ç°¡çŸ­è©•èª (20å­—å…§)"></textarea> 

                        <input type="file" id="mImg" accept="image/*" class="text-sm w-full"> 

                        <div class="flex gap-3 pt-2"> 

                            <button onclick="saveData()" id="saveBtn" class="flex-1 bg-indigo-950 text-white font-black py-5 rounded-2xl shadow-lg text-xl active:scale-95 transition-all">ç™¼å¸ƒè©•æ¸¬ â˜ï¸</button> 

                            <button onclick="cancelEdit()" id="cancelBtn" class="hidden px-6 bg-slate-100 rounded-2xl font-bold text-slate-400">X</button> 

                        </div> 

                    </div> 

                </div> 

            </div> 

 

            <div class="lg:w-2/3 order-1 lg:order-2"> 

                <div class="relative px-4 pt-8 pb-12"> 

                    <div class="outer-label -top-1 left-6 text-red-500">ğŸ’¸ æµªè²»é‡‘éŒ¢</div> 

                    <div class="outer-label -top-1 right-6 text-emerald-600">ğŸ’ è²´å©¦é¦–é¸</div> 

                    <div class="outer-label -bottom-1 left-6 text-slate-500">ğŸ’¤ å¹³åƒ¹ç²—ç”¨</div> 

                    <div class="outer-label -bottom-1 right-6 text-blue-600">ğŸ”¥ æ€§åƒ¹æ¯”ç‹</div> 

 

                    <div class="lg:w-2/3 order-1 lg:order-2"> 

    <div class="relative px-8 pt-10 pb-16"> <div class="outer-label -top-1 left-10 text-red-500">ğŸ’¸ è²´/é›£ç”¨</div> 

        <div class="outer-label -top-1 right-10 text-emerald-600">ğŸ’ è²´å©¦é¦–é¸</div> 

        <div class="outer-label -bottom-1 left-10 text-slate-500">ğŸ’¤ ç²—ç”¨</div> 

        <div class="outer-label -bottom-1 right-10 text-blue-600">ğŸ”¥ æ­£å˜¢</div> 

 

        <div class="absolute -left-2 top-1/2 -translate-y-1/2 -rotate-90 origin-center text-sm font-black text-slate-400 uppercase tracking-widest"> 

            ğŸ’° Price / åƒ¹éŒ¢ 

        </div> 
 

        <div class="chart-container relative bg-white rounded-[3rem] shadow-2xl border-8 border-white aspect-square ring-4 ring-pink-100/50"> 

            <div id="gridLayer" class="absolute inset-0 rounded-[2.5rem] overflow-hidden quadrant-bg"> 

                <div id="yLine" class="absolute h-full w-[2px] bg-pink-400/30"></div> 

                <div id="xLine" class="absolute w-full h-[2px] bg-pink-400/30"></div> 

            </div> 

            <div id="chartArea" class="absolute inset-0 z-30 p-6"></div> 

        </div> 
 

        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-sm font-black text-slate-400 uppercase tracking-widest"> 

            â­ Rating / è©•åˆ† 

        </div> 

    </div> 

</div> 

                </div> 

            </div> 

        </div> 

    </div> 

 

    <script> 

        const SB_URL = 'https://ayulzvrljioqcfoqrsev.supabase.co ';  

        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5dWx6dnJsamlvcWNmb3Fyc2V2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzNzk3MzUsImV4cCI6MjA4NDk1NTczNX0.3iCIGRfR42cg12qoE5IUHb0EFn1yq9dDqAW-jcFmQDo '; 

        let client, myName = localStorage.getItem('mask_username'), cachedData = [], editingId = null; 

 

        async function initApp() { 

            if (!window.supabase || SB_URL.includes('YOUR_')) return; 

            client = window.supabase.createClient(SB_URL, SB_KEY); 

            if (!myName) { 

                myName = prompt("è«‹è¼¸å…¥ä½ çš„åå­—ï¼š") || "é¢è†œå¤§å¸«"; 

                localStorage.setItem('mask_username', myName); 

            } 

            document.getElementById('displayUserName').innerText = "ğŸ‘¤ " + myName; 

            await loadData(); 

            setInterval(loadData, 15000); 

        } 

 

        async function loadData() { 

            const { data, error } = await client.from('masks').select('*').order('created_at', { ascending: false }); 

            if (!error) { cachedData = data; renderCurrentData(); } 

        } 

 

        function closeAllTooltips() { 

            document.querySelectorAll('.mask-node').forEach(n => n.classList.remove('active-node')); 

        } 

 

        function toggleTooltip(event) { 

            event.stopPropagation(); 

            const node = event.currentTarget; 

            const isActive = node.classList.contains('active-node'); 

            closeAllTooltips(); 

            if (!isActive) node.classList.add('active-node'); 

        } 

 

        function renderCurrentData() { 

    â€¯â€¯â€¯ const area = document.getElementById('chartArea'); 
    
    â€¯â€¯â€¯ area.innerHTML = ''; 
    
    â€¯â€¯â€¯â€¯ 
    
    â€¯â€¯â€¯ const limitP = parseFloat(document.getElementById('limitPrice').value) || 16; 
    
    â€¯â€¯â€¯ const limitR = parseFloat(document.getElementById('limitRating').value) || 10; 
    
    â€¯â€¯â€¯ const splitP = parseFloat(document.getElementById('splitPrice').value) || 8; 
    
    â€¯â€¯â€¯ const splitR = parseFloat(document.getElementById('splitRating').value) || 5; 
    
     
    
    â€¯â€¯â€¯ const xPct = ((splitR - 1) / (limitR - 1)) * 100; 
    
    â€¯â€¯â€¯ const yPct = (1 - (splitP / limitP)) * 100; 
    
     
    
    â€¯â€¯â€¯ document.getElementById('yLine').style.left = `${xPct}%`; 
    
    â€¯â€¯â€¯ document.getElementById('xLine').style.top = `${yPct}%`; 
    
     
    
    â€¯â€¯â€¯ // --- èª¿æ•´åˆ†ç•Œç·š Label ä½ç½® --- 
    
    â€¯â€¯â€¯ area.insertAdjacentHTML('beforeend', ` 
    
    â€¯â€¯â€¯â€¯â€¯â€¯â€¯ <div class="axis-label" style="left: ${xPct}%; top: -35px; transform: translateX(-50%); border-color: #f472b6; color: #f472b6;"> 
    
    â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯ ${splitR}åˆ† 
    
    â€¯â€¯â€¯â€¯â€¯â€¯â€¯ </div> 
       â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯ 
    
    â€¯â€¯â€¯â€¯â€¯â€¯â€¯ <div class="axis-label" style="left: -45px; top: ${yPct}%; transform: translateY(-50%); border-color: #f472b6; color: #f472b6;"> 
    
    â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯â€¯ $${splitP} 
    
    â€¯â€¯â€¯â€¯â€¯â€¯â€¯ </div> 

â€¯â€¯â€¯ `); 
            cachedData.forEach(m => { 

                const x = ((m.rating - 1) / (limitR - 1)) * 100; 

                const y = (1 - (m.price / limitP)) * 100; 

                const node = document.createElement('div'); 

                node.className = "mask-node absolute w-14 h-14 -ml-7 -mt-7"; 

                node.style.left = `${Math.max(8, Math.min(x, 92))}%`; 

                node.style.top = `${Math.max(8, Math.min(y, 92))}%`; 

                node.onclick = toggleTooltip; 

 

                let ttStyle = "left: 50%; transform: translateX(-50%);"; 

                if (x > 65) ttStyle = "right: -10px; left: auto; transform: translateX(0);"; 

                if (x < 35) ttStyle = "left: -10px; transform: translateX(0);"; 

                const verticalClass = y < 25 ? "tooltip-down" : ""; 

 

                node.innerHTML = ` 

                    <div class="w-full h-full rounded-2xl border-[3px] shadow-lg overflow-hidden bg-white ${m.user_name === myName ? 'border-pink-500 ring-4 ring-pink-100' : 'border-indigo-400'}"> 

                        ${m.img_url ? `<img src="${m.img_url}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center font-black text-slate-200 text-2xl uppercase">${m.name.substring(0,1)}</div>`} 

                    </div> 

                    <div class="tooltip ${verticalClass}" style="${ttStyle}" onclick="event.stopPropagation()"> 

                        <div class="flex justify-between items-start mb-4"> 

                            <p class="font-black text-pink-400 text-xl leading-tight break-words whitespace-normal pr-4 flex-1">${m.name}</p> 

                            <div class="flex gap-2 shrink-0"> 

                                <button onclick="startEdit(${m.id}, '${m.name.replace(/'/g, "\\'")}', ${m.price}, ${m.rating}, '${(m.source || '').replace(/'/g, "\\'")}', '${(m.comment || '').replace(/'/g, "\\'")}')" class="btn-action">âœï¸</button> 

                                <button onclick="deleteItem(${m.id}, '${m.name.replace(/'/g, "\\'")}')" class="btn-action">ğŸ—‘ï¸</button> 

                            </div> 

                        </div> 

                        <div class="grid grid-cols-3 gap-2 text-sm mb-4 border-b border-white/10 pb-3 text-center"> 

                            <div class="flex flex-col"><span class="text-white/40 text-[10px] uppercase font-bold">Price</span><span class="text-white font-bold">$${m.price}</span></div> 

                            <div class="flex flex-col"><span class="text-white/40 text-[10px] uppercase font-bold">Rating</span><span class="text-white font-bold">${m.rating}/10</span></div> 

                            <div class="flex flex-col truncate"><span class="text-white/40 text-[10px] uppercase font-bold">Shop</span><span class="text-white font-bold truncate">${m.source || '-'}</span></div> 

                        </div> 

                        <div class="bg-white/5 p-3 rounded-xl"> 

                            <p class="text-base italic text-slate-100 leading-relaxed break-words">"${m.comment || 'å†‡è©•èª'}"</p> 

                        </div> 

                        <p class="text-xs text-white/20 mt-4 text-right">Review by ${m.user_name}</p> 

                    </div> 

                `; 

                area.appendChild(node); 

            }); 

        } 

 

        async function saveData() { 

    const name = document.getElementById('mName').value; 

    const price = parseFloat(document.getElementById('mPrice').value); 

    const rating = parseFloat(document.getElementById('mRating').value); 

    const source = document.getElementById('mSource').value; 

    const comment = document.getElementById('mComment').value; 

    const imgFile = document.getElementById('mImg').files[0]; 

 

    if (!name || isNaN(price) || isNaN(rating)) return alert("å¡«å¥½è³‡æ–™å…ˆï¼ğŸ’…"); 

    const btn = document.getElementById('saveBtn'); 

    btn.disabled = true; 

    btn.innerText = "è™•ç†ä¸­..."; 

 

    try { 

        let finalImgUrl = ""; 

 

        if (imgFile) { 

            btn.innerText = "å£“ç¸®åœ–ç‰‡ä¸­..."; 

            const compressedBlob = await compressImageToBlob(imgFile); 

             

            // ç”Ÿæˆå”¯ä¸€æª”å 

            const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.jpg`; 

             

            btn.innerText = "ä¸Šå‚³åœ–ç‰‡è‡³é›²ç«¯..."; 

            const { data: uploadData, error: uploadError } = await client.storage 

                .from('mask-images') 

                .upload(fileName, compressedBlob); 

 

            if (uploadError) throw uploadError; 

 

            // ç²å–å…¬é–‹ URL 

            const { data: publicUrlData } = client.storage 

                .from('mask-images') 

                .getPublicUrl(fileName); 

             

            finalImgUrl = publicUrlData.publicUrl; 

        } 

 

        const payload = {  

            name,  

            price,  

            rating,  

            source,  

            comment,  

            user_name: myName, 

            img_url: finalImgUrl // å„²å­˜çš„æ˜¯ https://... ç¶²å€ï¼Œä¸å†æ˜¯å¹¾ç™¾è¬å­—çš„ Base64 

        }; 

 

        if (editingId) { 

            await client.from('masks').update(payload).eq('id', editingId); 

        } else { 

            await client.from('masks').insert([payload]); 

        } 

         

        cancelEdit(); 

        await loadData(); 

    } catch (err) { 

        console.error(err); 

        alert("å¤±æ•—ï¼š " + err.message); 

    } finally { 

        btn.disabled = false; 

        btn.innerText = "ç™¼å¸ƒè©•æ¸¬ â˜ï¸"; 

    } 

} 

 

// å£“ç¸®æˆ Blob æ ¼å¼ï¼Œé©åˆä¸Šå‚³ Storage 

function compressImageToBlob(file) { 

    return new Promise((resolve) => { 

        const reader = new FileReader(); 

        reader.readAsDataURL(file); 

        reader.onload = (e) => { 

            const img = new Image(); 

            img.src = e.target.result; 

            img.onload = () => { 

                const canvas = document.createElement('canvas'); 

                const MAX_WIDTH = 800; 

                let width = img.width; 

                let height = img.height; 

                if (width > MAX_WIDTH) { 

                    height *= MAX_WIDTH / width; 

                    width = MAX_WIDTH; 

                } 

                canvas.width = width; 

                canvas.height = height; 

                const ctx = canvas.getContext('2d'); 

                ctx.drawImage(img, 0, 0, width, height); 

                canvas.toBlob((blob) => resolve(blob), 'image/jpeg', 0.7); 

            }; 

        }; 

    }); 

} 

 

        async function deleteItem(id, name) { 

            event.stopPropagation(); 

            if (confirm(`ç¢ºå®šåˆªé™¤ã€Œ${name}ã€ï¼Ÿ`)) { await client.from('masks').delete().eq('id', id); await loadData(); } 

        } 

 

        function startEdit(id, name, price, rating, source, comment) { 

            event.stopPropagation(); 

            editingId = id;  

            document.getElementById('mName').value = name;  

            document.getElementById('mPrice').value = price; 

            document.getElementById('mRating').value = rating;  

            document.getElementById('mSource').value = source || ''; 

            document.getElementById('mComment').value = comment || ''; 

            document.getElementById('formTitle').innerText = "âœï¸ ç·¨è¼¯è©•æ¸¬";  

            document.getElementById('saveBtn').innerText = "æ›´æ–°è³‡æ–™ ğŸ’¾"; 

            document.getElementById('cancelBtn').classList.remove('hidden'); 

            window.scrollTo({ top: document.getElementById('inputCard').offsetTop - 20, behavior: 'smooth' }); 

        } 

 

        function cancelEdit() { 

            editingId = null;  

            ["mName", "mPrice", "mRating", "mSource", "mComment", "mImg"].forEach(id => document.getElementById(id).value = ''); 

            document.getElementById('formTitle').innerText = "ğŸš€ è©•æ¸¬é¢è†œ";  

            document.getElementById('saveBtn').innerText = "ç™¼å¸ƒè©•æ¸¬ â˜ï¸"; 

            document.getElementById('cancelBtn').classList.add('hidden'); 

        } 

 

        function toggleSettings() { document.getElementById('settingsPanel').classList.toggle('hidden'); } 

        initApp(); 

    </script> 

</body> 

</html> 






